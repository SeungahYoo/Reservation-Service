<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nts.reservation.mapper.DisplayInfoMapper">
	<select id="selectDisplayInfo" parameterType="int" resultType="com.nts.reservation.dto.DisplayInfo">
		SELECT
			category.id categoryId,
			category.name categoryName,
			display_info.create_date createDate,
			display_info.id displayInfoId,
			display_info.email email,
			display_info.homepage homepage,
			display_info.modify_date modifyDate,
			display_info.opening_hours openingHours,
			display_info.place_lot placeLot,
			display_info.place_name placeName,
			display_info.place_street placeStreet,
			product.content productContent,
			product.description productDescription,
			product.event productEvent,
			display_info.tel telephone,
			display_info.product_id productId
		FROM 
			display_info
		JOIN 
			product
		ON 
			display_info.product_id = product.id
		JOIN 
			category
		ON 
			product.category_id = category.id
		WHERE
			display_info.id = #{displayInfoId}
	</select>
	
	<select id="selectDisplayInfoImage" parameterType="int" resultType="com.nts.reservation.dto.DisplayInfoImage">
		SELECT
			file_info.content_type contentType,
			file_info.create_date createDate,
			file_info.delete_flag deleteFlag,
			display_info_image.display_info_id displayInfoId,
			display_info_image.id displayInfoImageId,
			display_info_image.file_id fildId,
			file_info.file_name fileName,
			file_info.modify_date modifyDate,
			file_info.save_file_name saveFileName 
		FROM 
			display_info_image
		JOIN 
			file_info
		ON 
			display_info_image.file_id = file_info.id
		WHERE
			display_info_image.display_info_id = #{displayInfoId}
	</select>
	
	<select id="selectProductImages" parameterType="int" resultType="com.nts.reservation.dto.ProductImage">
		SELECT 
			file_info.content_type contentType,
			file_info.create_date createDate,
			file_info.delete_flag deleteFlag,
			file_info.id fileInfoId,
			file_info.file_name fileName,
			file_info.modify_date modifyDate,
			product_image.product_id productId,
			product_image.id productImageId,
			file_info.save_file_name saveFileName,
			product_image.type 'type'
		FROM 
			file_info
		JOIN 
			product_image
		ON 
			file_info.id = product_image.file_id
		WHERE 
			product_image.product_id = #{productId}
	</select>
	
	<select id="selectProductPrices" parameterType="int" resultType="com.nts.reservation.dto.ProductPrice">
	</select>
	
	<select id="selectComments" parameterType="int" resultMap="commentsResult">
		SELECT 
			reservation_user_comment.comment 'comment', 
			reservation_user_comment.id commentId,
			reservation_user_comment.create_date createDate,
			reservation_user_comment.modify_date modifyDate,
			reservation_info.product_id productId,
			reservation_info.reservation_date reservationDate,
			reservation_info.reservation_email reservationEmail,
			reservation_info.id reservationInfoId,
			reservation_info.reservation_name reservationName,
			reservation_info.reservation_tel resrvationTelephone,
			reservation_user_comment.score score
		FROM 
			reservation_user_comment 
		JOIN 
			reservation_info 
		ON 
			reservation_user_comment.reservation_info_id = reservation_info.id
		WHERE
			reservation_info.product_id = #{productId}
	</select>
	
	<select id="selectCommentImages"  parameterType="int" resultType="com.nts.reservation.dto.CommentImage">
		SELECT 
			file_info.content_type contentType,
			file_info.create_date createDate,
			file_info.delete_flag deleteFlag,
			reservation_user_comment_image.file_id fileId,
			file_info.file_name fileName,
			reservation_user_comment_image.id imageId,
			file_info.modify_date modifyDate,
			reservation_user_comment_image.reservation_info_id reservationInfoId,
			file_info.save_file_name saveFileName,
			reservation_user_comment_image.reservation_user_comment_id reservationUserCommentId
		FROM 
			reservation_user_comment_image
		JOIN 
			file_info
		ON 
			reservation_user_comment_image.file_id = file_info.id
		WHERE
			reservation_user_comment_image.reservation_user_comment_id = #{commentId}
	</select>
	
	<resultMap id="commentsResult" type="com.nts.reservation.dto.Comment">
		<result property="comment" column="comment"/>
		<result property="commentId" column="commentId"/>
		<result property="createDate" column="createDate"/>
		<result property="modifyDate" column="modifyDate"/>
		<result property="productId" column="productId"/>
		<result property="reservationDate" column="reservationDate"/>
		<result property="reservationEmail" column="reservationEmail"/>
		<result property="reservationInfoId" column="reservationInfoId"/>
		<result property="reservationName" column="reservationName"/>
		<result property="reservationTelephone" column="resrvationTelephone"/>
		<result property="score" column="score"/>
		<collection property="commentImages" column="commentId" javaType="java.util.ArrayList" ofType="com.nts.reservation.dto.CommentImage" select="selectCommentImages"/>
	</resultMap>




</mapper>